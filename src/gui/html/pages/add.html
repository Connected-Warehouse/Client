<!DOCTYPE html>
<html lang="fr" xmlns="http://www.w3.org/1999/html">
<head>
    <div data-include="../partial/common_head.html"></div>
</head>
<body>

<!-- Header -->
<div data-include="../partial/header.html"></div>

<div class="container">
    <h2 data-translate="add_title">Ajouter un package</h2>

    <!-- Formulaire Package -->
    <form id="form-package" class="add-form" onsubmit="event.preventDefault(); addPackage();">

        <div class="form-row">
            <label for="packageCode">Code du package</label>
            <input type="text" id="packageCode" placeholder="Code du package" required>
        </div>

        <div class="form-row">
            <label for="packageWeigth">Poid item</label>
            <input type="number" id="packageWeigth" placeholder="0.1kg" required>
        </div>

        <div class="form-row">
            <label for="packageZone">Zone</label>
            <input type="text" id="packageZone" placeholder="Zone" required>
        </div>

        <div class="form-row">
            <label for="destinationId">Provenance</label>
            <input type="number" id="destinationId" placeholder="source (ID)" required>
        </div>

        <div class="form-row">
            <label for="sourceId">Destination</label>
            <input type="number" id="sourceId" placeholder="destination (ID)" required>
        </div>

        <label><input type="checkbox" id="packageRefrigerated"> Refrigere</label>
        <label><input type="checkbox" id="packageFragile"> Fragile</label>

        <button type="submit" class="action" data-translate="add_button">Ajouter Package</button>
    </form>

    <button type="button" class="back action" onclick="goBack()" data-translate="back_button">Retour au menu</button>

    <div class="error" id="error"></div>
    <div class="success" id="success"></div>
</div>


<!-- Footer -->
<div data-include="../partial/footer.html"></div>

<!-- Scripts -->
<script src="../script/basic_include.js" defer></script>
<script src="../script/translation.js" defer></script>
<script src="../script/settings.js" defer></script>
<script src="../script/MenuCall.js" defer></script>
<script>
window.addEventListener('pywebviewready', () => {
    console.log('✅ Bridge PyWebView prêt');
});

// Fonctions d'ajout
async function addPackage() {
    const errorDiv = document.getElementById('error');
    const successDiv = document.getElementById('success');

    // Récupération des champs
    const packageCode = document.getElementById('packageCode').value;
    const packageWeigth = document.getElementById('packageWeigth').value;
    const packageZone = document.getElementById('packageZone').value;
    const destinationId = document.getElementById('destinationId').value;
    const sourceId = document.getElementById('sourceId').value;
    const packageRefrigerated = document.getElementById('packageRefrigerated').checked;
    const packageFragile = document.getElementById('packageFragile').checked;

    // Vérification minimale : tous les champs obligatoires
    if (!packageCode || !packageWeigth || !packageZone || !destinationId || !sourceId) {
        errorDiv.innerText = getTranslation("add_error");
        return;
    }

    // Construction de l'objet à envoyer
    const data = {
        code: packageCode,
        weigth: packageWeigth,
        zone: packageZone,
        provenance: destinationId,
        destination: sourceId,
        refrigerated: packageRefrigerated || false,
        fragile: packageFragile || false
    };

    errorDiv.innerText = "";
    successDiv.innerText = getTranslation("add_success");

    // ✅ Appel API Python
    try {
        const response = await window.pywebview.api.add_package(data);
        console.log("✅ Reponse Python :", response);
        successDiv.innerText = response; // ou garde la traduction si tu preferes
    } catch (err) {
        console.error("❌ Erreur API :", err);
        errorDiv.innerText = "Erreur de communication avec le backend.";
    }
}
</script>


</body>
</html>
